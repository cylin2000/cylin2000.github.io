<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <title>搭建本地的Jenkins持续集成系统 | Calvin&#39;s Blog</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="description" content="嗨，我是蔡云林，一名软件开发者。">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="搭建本地的Jenkins持续集成系统 | Calvin&#39;s Blog">
    <meta name="twitter:description" content="嗨，我是蔡云林，一名软件开发者。">

    <meta property="og:type" content="article">
    <meta property="og:title" content="搭建本地的Jenkins持续集成系统 | Calvin&#39;s Blog">
    <meta property="og:description" content="嗨，我是蔡云林，一名软件开发者。">

    
    <meta name="author" content="Calvin Cai">
    
    <link rel="stylesheet" href="/css/vno.css">
    
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/img/favicon.png">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="Calvin&#39;s Blog" href="/atom.xml">
    

    <link rel="canonical" href="http://www.caiyunlin.com/2017/12/install-jenkins/"/>

             
    
    
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    
</head>

<body class="home-template">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 Calvin&#39;s Blog 的主页"><img src="/img/avatar.jpg" width="80" alt="Calvin&#39;s Blog logo" class="panel-cover__logo logo"></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Calvin&#39;s Blog">Calvin&#39;s Blog</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">大道至简 悟在天成</span>
        
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">嗨，我是蔡云林，一名软件开发者。</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">
        
          <p class="panel-cover__description">这里是我记录，思考和实践的小站，欢迎你的访问。</p>
        
        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
            
              <li class="navigation__item"><a href="/apps">工具</a></li>
            
              <li class="navigation__item"><a href="/about">关于</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  

  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/cylin2000" title="查看我的GitHub主页" target="_blank">
      <i class="social fa fa-github"></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  <li class="navigation__item">
    <a href="https://twitter.com/cylin2000" title="上Twitter找我" target="_blank">
      <i class="social fa fa-twitter"></i>
      <span class="label">Twitter</span>
    </a>
  </li>


<!-- Email -->

  <li class="navigation__item">
    <a href="cylin2000@163.com" title="邮件联系我" target="_blank">
      <i class="social fa fa-envelope"></i>
      <span class="label">Email</span>
    </a>
  </li>

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class="social fa fa-rss"></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-blue"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-12-03T13:50:20.000Z" class="post-list__meta--date date">2017-12-03</time> &#8226; <span class="post-meta__tags tags"> 
	<a class="article-category-link" href="/categories/技术整理/">技术整理</a>

 </span>
      <span class="page-pv">
       阅读 <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">搭建本地的Jenkins持续集成系统</h1>
  </header>

  <section class="post">
    <blockquote>
<p>本文简要介绍如何在本地搭建一套Jenkins持续集成系统，可以快速的在本地测试pipeline</p>
</blockquote>
<p>基本实现是这样的</p>
<ol>
<li>在虚拟机中安装一套Ubuntu系统</li>
<li>在Ubuntu中，安装Jenkins 和 Docker</li>
<li>在Jenkins中配置Job，从GitHub获取代码，并且自动Docker实例，运行测试，编译和部署，之后销毁Docker实例</li>
</ol>
<a id="more"></a>
<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><p>该系统选择的基础环境是 Ubuntu 操作系统，所以务必先准备好Ubuntu，推荐版本是16.04，这个不是最新的版本，但是是长期支持的稳定版本。</p>
<p>本地虚拟机可以到官网下载 Ubuntu 16.04 Server 版本镜像。</p>
<p><a href="http://releases.ubuntu.com/16.04/ubuntu-16.04.6-server-amd64.iso" target="_blank" rel="noopener">http://releases.ubuntu.com/16.04/ubuntu-16.04.6-server-amd64.iso</a></p>
<p>注意：安装Ubuntu的时候，请选择安装组件 LAMP 和 SSH Server</p>
<h2 id="安装-Jenkins"><a href="#安装-Jenkins" class="headerlink" title="安装 Jenkins"></a>安装 Jenkins</h2><p>Ubuntu准备好了后，我们就可以直接登录系统，开始安装Jenkins了<br>参考官方WIKI：<a href="https://wiki.jenkins.io/display/JENKINS/Installing+Jenkins+on+Ubuntu" target="_blank" rel="noopener">https://wiki.jenkins.io/display/JENKINS/Installing+Jenkins+on+Ubuntu</a></p>
<p>执行下面脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加Jenkins的Global Key到APT中</span></span><br><span class="line">wget -q -O - https://jenkins-ci.org/debian/jenkins-ci.org.key | sudo apt-key add - </span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新APT库，安装Jenkins</span></span><br><span class="line">sudo sh -c <span class="string">'echo deb http://pkg.jenkins-ci.org/debian-stable binary/ &gt; /etc/apt/sources.list.d/jenkins.list'</span>  </span><br><span class="line">sudo apt-get update  </span><br><span class="line">sudo apt-get install jenkins</span><br></pre></td></tr></table></figure></p>
<h2 id="启动-Jenkins"><a href="#启动-Jenkins" class="headerlink" title="启动 Jenkins"></a>启动 Jenkins</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo service jenkins start  </span><br><span class="line"></span><br><span class="line"># 停止</span><br><span class="line">sudo service jenkins stop</span><br><span class="line"></span><br><span class="line"># 相关路径</span><br><span class="line">访问路径：http://localhost:8080  </span><br><span class="line">安装路径：/var/lib/jenkins  </span><br><span class="line">日志路径：/var/log/jenkins</span><br></pre></td></tr></table></figure>
<h2 id="配置-Jenkins"><a href="#配置-Jenkins" class="headerlink" title="配置 Jenkins"></a>配置 Jenkins</h2><ul>
<li>在浏览器访问Jenkins地址，注意使用正确的ip地址，可以使用ifconfig查出地址， 如 <a href="http://192.168.0.101:8080" target="_blank" rel="noopener">http://192.168.0.101:8080</a></li>
<li><p>在登录页面会需要你输入admin的password，使用下面命令获的密码，输入密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/jenkins_home/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure>
</li>
<li><p>点击继续，在选择插件界面，选择 Install suggested Plugins</p>
</li>
<li>插件安装完毕之后，配置登录的管理员 用户名和密码</li>
<li>配置完成</li>
</ul>
<h2 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h2><p>我们期望 Jenins 的Deployment Pipeline 运行在Docker里面，所以需要安装一下 Docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 清理旧版 docker</span><br><span class="line">sudo apt-get remove docker docker-engine docker.io</span><br><span class="line"></span><br><span class="line"># 更新 APT-GET 库准备安装 一些前置软件</span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line"># 安装HTTPS传输,CURL等软件</span><br><span class="line">sudo apt-get install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"></span><br><span class="line"># 添加 Docker’s official GPG key:</span><br><span class="line"></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">sudo apt-key fingerprint 0EBFCD88</span><br><span class="line"></span><br><span class="line"># Set Docker 安装库</span><br><span class="line"></span><br><span class="line">sudo add-apt-repository \</span><br><span class="line">   &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span><br><span class="line">   $(lsb_release -cs) \</span><br><span class="line">   stable&quot;</span><br><span class="line"></span><br><span class="line"># 安装Docker</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure>
<h2 id="运行-Docker"><a href="#运行-Docker" class="headerlink" title="运行 Docker"></a>运行 Docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br><span class="line"></span><br><span class="line">sudo docker build -f dockerfile-receiver</span><br><span class="line"></span><br><span class="line">sudo docker run -p 9080:80 nginx</span><br><span class="line"></span><br><span class="line">sudo docker run -it 9080:80 nginx</span><br></pre></td></tr></table></figure>
<h2 id="设置-Jenkins-运行-Docker的权限"><a href="#设置-Jenkins-运行-Docker的权限" class="headerlink" title="设置 Jenkins 运行 Docker的权限"></a>设置 Jenkins 运行 Docker的权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 如果还没有 docker group 就添加一个：</span><br><span class="line">sudo groupadd docker</span><br><span class="line"></span><br><span class="line"># 将当前用户和jenkins用户加入该 group 内。然后退出并重新登录就生效啦。</span><br><span class="line">sudo gpasswd -a $&#123;USER&#125; docker</span><br><span class="line">sudo gpasswd -a jenkins docker</span><br><span class="line"></span><br><span class="line"># 重启 docker 服务</span><br><span class="line">sudo service docker restart</span><br><span class="line"></span><br><span class="line"># 切换当前会话到新 group</span><br><span class="line">newgrp docker</span><br><span class="line"></span><br><span class="line"># 重启 jenkins 服务</span><br><span class="line">sudo service jenkins restart</span><br></pre></td></tr></table></figure>
<p>至此 Jenkins 环境就搭建好了</p>
<h1 id="配置-Jenkins-Pipeline"><a href="#配置-Jenkins-Pipeline" class="headerlink" title="配置 Jenkins Pipeline"></a>配置 Jenkins Pipeline</h1><p>下面尝试配置一个Jenkins的Pipeline，测试一下部署流程，基本模拟步骤如下：</p>
<ol>
<li>创建一个Jenkins Pipeline</li>
<li>Pipeline中使用远程代码库中的Jenkinsfile在指定部署内容</li>
<li>编写提交Jenkinsfile</li>
</ol>
<h2 id="准备代码库"><a href="#准备代码库" class="headerlink" title="准备代码库"></a>准备代码库</h2><ol>
<li>去GitHub上面创建一个测试代码库，如jenkins-test,可以参考 <a href="https://github.com/cylin2000/jenkins-test" target="_blank" rel="noopener">https://github.com/cylin2000/jenkins-test</a></li>
<li>代码库里面创建 Jenkinsfile 文件，内容是json格式的定义，如下:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123; </span><br><span class="line">    	docker &#123;</span><br><span class="line">    		image  &apos;node:6.3&apos;</span><br><span class="line">    		args &apos;-v $HOME/.n63:/root/.n63 -u root:root&apos;</span><br><span class="line">    	&#125; </span><br><span class="line">    &#125; </span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&apos;Example Build&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh &apos;npm --version&apos;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>这个Job很简单，定义了使用docker的node 6.3版本的image 作为 build 的容器，build开始的时候，执行 npm –version 就可以显示npm的版本，注意运行Jenkins的主机不需要安装nodejs的</p>
<pre><code>注意 args 中的 -u root:root 一定要有，否则会出现 steps 里面的命令，如 npm install 之类的命令没有权限运行
</code></pre><ol start="3">
<li><p>代码提交之后，就回到Jenkins界面，选择”New Item”，填入名称 如 “HelloPipeline” 选择 “Pipeline”，点击”OK”<br><img src="http://images.caiyunlin.com/20171204020949.png" alt="image"></p>
</li>
<li><p>在Pipeline配置界面里，”Definition”选择”Pipeline script from SCM”,”SCM”选择 “Git”, 然后填入你的Repository地址，最后点击下面的 “Save” 按钮<br><img src="http://images.caiyunlin.com/20171204021321.png" alt="image"></p>
</li>
</ol>

  </section>

</article>


<div id="vcomments"></div>
<script>
  new Valine({
      el: '#vcomments',
      appId: 'u1VC6WDmgvRCBXGwOgDmoKVe-gzGzoHsz',
      appKey: '4uw8mTR1jYn9VD038BGp4tM5'
  })
</script>


<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">上一篇</span>
                <h2 class="post-list__post-title post-title"><a href="/2017/06/wechat-shareappmessage-bug/" title="微信使用JSSDK分享OAuth链接的问题">微信使用JSSDK分享OAuth链接的问题</a></h2>
                <p class="excerpt">
                
                使用微信的JSSDK，可以在转发图文给朋友或者转发到朋友圈的时候，对转发的标题，描述以及图片进行自定义，这是个很好的功能，然而最近测试的时候发现一个Bug，当转发的链接是OAuth链接的时候，这段定义就失效了。
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2017-06-28T07:33:00.000Z" class="post-list__meta--date date">2017-06-28</time> <a class="btn-border-small" href="/2017/06/wechat-shareappmessage-bug/">继续阅读</a></div>
                       
            </div>
        

               
            <div class="read-more-item">
                <span class="read-more-item-dim">下一篇</span>
                <h2 class="post-list__post-title post-title"><a href="/2018/04/export-excel/" title="一个简便的Excel导出方案">一个简便的Excel导出方案</a></h2>
                <p class="excerpt">
                
                导出Excel是开发中遇到的一个常见需求，但是不同的后端服务程序可能需要引入不同的类库，比如PHP需要PHPExcel，C#需要Office组件或者其他第三方Excel解析类。 这里提供另外一个思路，可以不需要引入第三方类库来解决Excel的导出问题。
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2018-04-15T09:16:45.000Z" class="post-list__meta--date date">2018-04-15</time> <a class="btn-border-small" href="/2018/04/export-excel/">继续阅读</a></div>
                           
            </div>
        
     
   
   
  
</section>

  

            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<footer class="footer">
    <span class="footer__copyright">
        &copy; 2020 Calvin Cai - 本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
       
    </span>
    <span class="footer__copyright">
         <a href>沪ICP备17011644号-1</a> 由 <a href="http://hexo.io">Hexo</a> 强力驱动，使用 <a href="https://github.com/cylin2000/hexo-theme-vno ">Vno</a> 主题
    </span>
    <span class="footer__copyright">
        <span id="busuanzi_container_site_pv">
            本站总访问量<span id="busuanzi_value_site_pv"></span>次
        </span>
    </span>
       
    
    
</footer>


        </div>
    </div>

     
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?203c5ae1415eab702ef17ad33e3ee952";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    
    
</body>
</html>
